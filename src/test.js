input = "-epyt-riap,epyt-gnirts,*##,+##,oof,rab,<##,foe##,trop-tuodts,sgra-on##,epyt-notelgnis,epyt-trop-tuptuo,pam,tuodts##,dneppa,*,trop-tuptuo-tnerruc,?tcejbo-foe,?ecnatsni,rahc-etirw##,gnirts>-rebmun,tneitouq,-##,tsil-etirw,tsil,dlof,enilwen,2gra,-,ylppa,ton,<,gnirts>-tsil,pam##,etirw,+,htgnel,snoc,esolc,srahc-etirw,rorre,litnu-nacs,?lauqe,?bir,yalpsid,?riap,rdc,1dleif,0dleif,rac,2dleif,rahc-etirw,di,?vqe,1gra,,,,bir;8Ck>mHlZ#nj4j9j,]#)li&88mWmYOmSmci/YEl`j#WmSmai,^~GlCl_|!<)li&88mSmFla_X%lCl_~Gl_}'>mYCk>mRlWmYEntYEnpj2j7oj*]*)l_>mYCk>mRl^|>mWmYEnnmpj+]+8Ck>mRl`>mYCk>mRl_>mYCk>mRl^})!6)li$6maEl_>mAma^Dl^~?mkBl^}'!F)li$)li$8Fm`El^>mRm`Dl^~?mkBl^>mAm`vC~?mkBl^}'!15lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mi$5lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mLlj1~?mkBl`YBm^[&El`Dl_5lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mi$5lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mLlj1~?mkBl`YMk~?mi&_|!;1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mi$1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mLlj1~?mkBl`YBm^[&El`Dl_1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mi$1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mLlj1~?mkBl`YMk~?mi&_|!C*m_u>mi$*m_u>mLlj1~?mkBl_YBm^[%El_Dl^*m_u>mi$*m_u>mLlj1~?mkBl_YMk~?mi&^z!*8JmDl__>mi$8JmDl__>mLlj1~?mkBl`YBm^[&El`Dl_8JmDl__>mi$8JmDl__>mLlj1~?mkBl`YMk~?mi&_|!M)lj'y]':nti%YPk!L(mj(^{](:npkk]$t!J:nlkl!P:nlkm!>4pi$bi%_j)|!A8DnbYGm``iG8Gm`k~?mj8^YBm^[&El`Dl_8DnbYGm``iG8Gm`k~?mj8^j8~?mi&_|!N8Dn`lj-z!:8Dn`kj,z!GiA]-iN],i:]&j8])i>!4)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlcYBm^[)ElcDlb)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlci&~?mi&b},!D)l_8DnFlbX'mClb`^~Gl`})]#)li&88mWmYOmSmci/YEl`j#WmSmai,^~GlCl_|!<)li&88mSmFla_X%lCl_~Gl_}'!@:nlkn>mj5!O7%lOmb`[$Nl)l^7*mX)lFl_Cl^~Gl^{[%Nl)l_88mX,maFl_Cl^~Gl^}'i$i$|!9)lk8:mPlFl_l~Gl^{!E)l^z!/i.!,i-!8#nj/`^}'!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k!3)li$)li$)li$)li$3mDlaDl_~JmElaEl_~JmBlaBl_~Il`)li$~?mj%Bl_~Il_)l^~^?m`^}'!?(mi$^{!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k!3)li$)li$)li$)li$3mDlaDl_~JmElaEl_~JmBlaBl_~Il`)li$~?mj%Bl_~Il_)l^~^?m`^}'!?(mi$^{!4)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlcYBm^[)ElcDlb)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlci&~?mi&b},!D)l_8DnFlbX'mClb`^~Gl`})]#)li&88mWmYOmSmci/YEl`j#WmSmai,^~GlCl_|!<)li&88mSmFla_X%lCl_~Gl_}'!@:nlko>mj3!O7%lOmb`[$Nl)l^7*mX)lFl_Cl^~Gl^{[%Nl)l_88mX,maFl_Cl^~Gl^}'i$i$|!9)lk8:mPlFl_l~Gl^{!E)l^z!/i.!,i-!8#nj/`^}'!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k!3)li$)li$)li$)li$3mDlaDl_~JmElaEl_~JmBlaBl_~Il`)li$~?mj%Bl_~Il_)l^~^?m`^}'!?(mi$^{!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k]4:nk:nk:nki&qpo]9:nk:nk:nki&nml]2:nnm:nk:nki&vS)vS)]7:nnm:nk:nki&vS(vS(]0:nnv7:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nki&vS,vS3vS)vS(vS;vS5vS0vS9vS7vCvS;vS6vS5vCvS;vS*vS,vS1vS)vRD]6:nnp:nk:nk:nk:nk:nki&vS-vS6vS,vDvF]8:nki&k]5:nk:nk:nki&mlwB]1:nnvR$:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nki&vR#vS5vS6vS0vS;vS*vS5vS<vS-vCvS,vS/vS;vCvS6vS;vCvS+vS,vS:vS:vS(vS7vCvS,vS9vS,vS>vCvS:vS;vS5vS,vS4vS<vS.vS9vS(vCvS@vS5vS(vS4vCvS6vS6vRI]3:nk:nk:nki&mlwB!J:nlkl!P:nlkm!@:nlkn!@:nlkn!H:nlkp!N:nlkq!A:nlkr!::nlks!>:nlkt!(:nlku!+:nlkv.!.:nlkv/!-:nlkv0!2:nlkv1!7:nlkv2!B:nlkv3!':nlkv4!):nlkv5{"; // @@(replace "-epyt-riap,epyt-gnirts,*##,+##,oof,rab,<##,foe##,trop-tuodts,sgra-on##,epyt-notelgnis,epyt-trop-tuptuo,pam,tuodts##,dneppa,*,trop-tuptuo-tnerruc,?tcejbo-foe,?ecnatsni,rahc-etirw##,gnirts>-rebmun,tneitouq,-##,tsil-etirw,tsil,dlof,enilwen,2gra,-,ylppa,ton,<,gnirts>-tsil,pam##,etirw,+,htgnel,snoc,esolc,srahc-etirw,rorre,litnu-nacs,?lauqe,?bir,yalpsid,?riap,rdc,1dleif,0dleif,rac,2dleif,rahc-etirw,di,?vqe,1gra,,,,bir;8Ck>mHlZ#nj4j9j,]#)li&88mWmYOmSmci/YEl`j#WmSmai,^~GlCl_|!<)li&88mSmFla_X%lCl_~Gl_}'>mYCk>mRlWmYEntYEnpj2j7oj*]*)l_>mYCk>mRl^|>mWmYEnnmpj+]+8Ck>mRl`>mYCk>mRl_>mYCk>mRl^})!6)li$6maEl_>mAma^Dl^~?mkBl^}'!F)li$)li$8Fm`El^>mRm`Dl^~?mkBl^>mAm`vC~?mkBl^}'!15lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mi$5lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mLlj1~?mkBl`YBm^[&El`Dl_5lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mi$5lj0*m_vS7>mAm_vF~?mlBl_6m_Dl_~?mnBl_1m_El_~?mmBl_*m_vL>mYFm_El_>mRm_Dl_>mAm_vK~?mkBl_1m_YIl_~?mi$Il_*m_vL>mAm_vK~?mi&_1m_j6~YLl_*m_vS;>mAm_vF~?mi%_*m_vS->mAm_vF~?mi$_>mLlj1~?mkBl`YMk~?mi&_|!;1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mi$1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mLlj1~?mkBl`YBm^[&El`Dl_1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mi$1m__*m_vE>mMm_Dl_>mAm_vE~i$1m__*m_vE>mMm_Dl_>mAm_vE~?mnBl_~Il_>mLlj1~?mkBl`YMk~?mi&_|!C*m_u>mi$*m_u>mLlj1~?mkBl_YBm^[%El_Dl^*m_u>mi$*m_u>mLlj1~?mkBl_YMk~?mi&^z!*8JmDl__>mi$8JmDl__>mLlj1~?mkBl`YBm^[&El`Dl_8JmDl__>mi$8JmDl__>mLlj1~?mkBl`YMk~?mi&_|!M)lj'y]':nti%YPk!L(mj(^{](:npkk]$t!J:nlkl!P:nlkm!>4pi$bi%_j)|!A8DnbYGm``iG8Gm`k~?mj8^YBm^[&El`Dl_8DnbYGm``iG8Gm`k~?mj8^j8~?mi&_|!N8Dn`lj-z!:8Dn`kj,z!GiA]-iN],i:]&j8])i>!4)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlcYBm^[)ElcDlb)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlci&~?mi&b},!D)l_8DnFlbX'mClb`^~Gl`})]#)li&88mWmYOmSmci/YEl`j#WmSmai,^~GlCl_|!<)li&88mSmFla_X%lCl_~Gl_}'!@:nlkn>mj5!O7%lOmb`[$Nl)l^7*mX)lFl_Cl^~Gl^{[%Nl)l_88mX,maFl_Cl^~Gl^}'i$i$|!9)lk8:mPlFl_l~Gl^{!E)l^z!/i.!,i-!8#nj/`^}'!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k!3)li$)li$)li$)li$3mDlaDl_~JmElaEl_~JmBlaBl_~Il`)li$~?mj%Bl_~Il_)l^~^?m`^}'!?(mi$^{!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k!3)li$)li$)li$)li$3mDlaDl_~JmElaEl_~JmBlaBl_~Il`)li$~?mj%Bl_~Il_)l^~^?m`^}'!?(mi$^{!4)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlcYBm^[)ElcDlb)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mi$)la4pbFleX)mClebClc_~i$)la4pbFleX)mClebClc_~VlJm_a~Glb>mLlj1~?mkBlci&~?mi&b},!D)l_8DnFlbX'mClb`^~Gl`})]#)li&88mWmYOmSmci/YEl`j#WmSmai,^~GlCl_|!<)li&88mSmFla_X%lCl_~Gl_}'!@:nlko>mj3!O7%lOmb`[$Nl)l^7*mX)lFl_Cl^~Gl^{[%Nl)l_88mX,maFl_Cl^~Gl^}'i$i$|!9)lk8:mPlFl_l~Gl^{!E)l^z!/i.!,i-!8#nj/`^}'!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k!3)li$)li$)li$)li$3mDlaDl_~JmElaEl_~JmBlaBl_~Il`)li$~?mj%Bl_~Il_)l^~^?m`^}'!?(mi$^{!I8=lX&mi&_8=l:nkX'mi&YAmakvP~Umk_[$Nl)l^7-m_`~Umak:nkb^QmYAmYNmu``vR%YHmu^}'i${!=#nj.Pl_^{!9)lk8:mPlEl_l~Gl^{!0YKlj/!K87l)li$(mbBl^~Il^{{]%p].n]/k]4:nk:nk:nki&qpo]9:nk:nk:nki&nml]2:nnm:nk:nki&vS)vS)]7:nnm:nk:nki&vS(vS(]0:nnv7:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nki&vS,vS3vS)vS(vS;vS5vS0vS9vS7vCvS;vS6vS5vCvS;vS*vS,vS1vS)vRD]6:nnp:nk:nk:nk:nk:nki&vS-vS6vS,vDvF]8:nki&k]5:nk:nk:nki&mlwB]1:nnvR$:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nk:nki&vR#vS5vS6vS0vS;vS*vS5vS<vS-vCvS,vS/vS;vCvS6vS;vCvS+vS,vS:vS:vS(vS7vCvS,vS9vS,vS>vCvS:vS;vS5vS,vS4vS<vS.vS9vS(vCvS@vS5vS(vS4vCvS6vS6vRI]3:nk:nk:nki&mlwB!J:nlkl!P:nlkm!@:nlkn!@:nlkn!H:nlkp!N:nlkq!A:nlkr!::nlks!>:nlkt!(:nlku!+:nlkv.!.:nlkv/!-:nlkv0!2:nlkv1!7:nlkv2!B:nlkv3!':nlkv4!):nlkv5{" (encode 92))@@



debug = false;
// )@@



lengthAttr = "length";
isNode = process?.versions?.node != null;

// Implement putchar/getchar to the terminal 

fs = require("fs"); // @@(feature (or js/node/fs getchar putchar))@@

putchar = (c) => { 
    let buffer = Buffer.alloc(1); 
    buffer[0] = c; 
    fs.writeSync(1, buffer, 0, 1); 
    return c; 
}; 

getchar_sync = () => { 
    let buffer = Buffer.alloc(1); 
    if (fs.readSync(0, buffer, 0, 1)) 
        return buffer[0]; 
    return -1; 
}; 

getchar = () => { 
    push(pos<input[lengthAttr] ? get_byte() : getchar_sync()); 
    return true; // indicate that no further waiting is necessary 
}; 

sym2str = (s) => chars2str(s[1][0]);  //debug
chars2str = (s) => (s===NIL) ? "" : (String.fromCharCode(s[0])+chars2str(s[1]));  //debug

// )@@






// --------------------------------------------------------------

// VM


// build the symbol table

pos = 0;
get_byte = () => input[pos++].charCodeAt(0);
get_code = () => { let x = get_byte()-35; return x<0 ? 57 : x; };
get_int = (n) => { let x = get_code(); n *= 46; return x<46 ? n+x : get_int(n+x-46); };

pop = () => { let x = stack[0]; stack = stack[1]; return x; };

FALSE = [0,0,5]; TRUE = [0,0,5]; NIL = [0,0,5];

symtbl = NIL;
n = get_int(0);
while (n-- > 0) symtbl=[[0,[NIL,0,3],2],symtbl,0]; // symbols with empty names

accum = NIL;
n = 0;
while (1) {
  c = get_byte();
  if (c == 44) { symtbl=[[0,[accum,n,3],2],symtbl,0]; accum = NIL; n = 0; continue; }
  if (c == 59) break;
  accum = [c,accum,0];
  n++;
}

symtbl = [[0,[accum,n,3],2],symtbl,0];

symbol_ref = (n) => list_tail(symtbl,n)[0];
list_tail = (x,i) => i ? list_tail(x[1],i-1) : x;

// decode the instruction graph

stack = 0;

while (1) {
  x = get_code();
  n = x;
  d = 0;
  op = -1;
  while ((d=[20,30,0,10,11,4][++op])+2<n) n -= d+3;
  if (x>90)
    n = pop();
  else {
    if (!op) stack = [0,stack,0];
    n = n>=d ? (n==d ? get_int(0) : symbol_ref(get_int(n-d-1))) : op<3 ? symbol_ref(n) : n;
    if (4<op) {
      n = [[n,0,pop()],0,1];
      if (!stack) break;
      op=4;
    }
  }
  stack[0] = [op?op-1:0,n,stack[0]];
}

set_global = (x) => { symtbl[0][0] = x; symtbl = symtbl[1]; };

set_global([0,symtbl,1]); // primitive 0
set_global(FALSE);
set_global(TRUE);
set_global(NIL);

// RVM core

pc = n[0][2];
stack = [0,0,[5,0,0]]; // primordial continuation (executes halt instr.)

push = (x) => ((stack = [x,stack,0]), true);
bool2scm = (x) => x ? TRUE : FALSE;
// )@@



















is_rib = (x) => x[lengthAttr];

get_opnd = (o) => is_rib(o) ? o : list_tail(stack,o);
get_cont = () => { let s = stack; while (!s[2]) s = s[1]; return s; };

prim1 = (f) => () => push(f(pop()));
prim2 = (f) => () => push(f(pop(),pop()));
prim3 = (f) => () => push(f(pop(),pop(),pop()));

primitives = [
  prim3((z, y, x) => [x, y, z]),                    //  @@(primitive (rib a b c))@@
prim2((fd, ch) => fs.writeSync(fd, String.fromCodePoint(ch), null, 'utf8')),() => push(1),() => {
        let num_args = 0;
        console.log('Before: ');
        console.dir(stack, { depth : 6 });
        let arg = pop();
        let f = pop();
        push(f);
        // we don't push the function, because it is already on top of the stack
        while (arg !== NIL) {
            console.log('Arg: ', arg[0]);
            push(arg[0]);
            arg=arg[1];
            num_args++;
        }
        push(num_args); // @@(feature arity-check)@@
        console.log('After: ');
        console.dir(stack, { depth : 8 });
        return f;
     }, () => {
        let num_args = 0;
        console.log('Before: ');
        console.dir(stack, { depth : 6 });
        let arg = pop();
        let f = pop();
        push(f);
        // we don't push the function, because it is already on top of the stack
        while (arg !== NIL) {
            console.log('Arg: ', arg[0]);
            push(arg[0]);
            arg=arg[1];
            num_args++;
        }
        push(num_args); // @@(feature arity-check)@@
        console.log('After: ');
        console.dir(stack, { depth : 8 });
        return f;
     },   prim2((y, x) => x/y|0),                           //  @@(primitive (quotient x y))@@
  prim2((y, x) => x*y),                             //  @@(primitive (* x y))@@
  prim2((y, x) => x-y),                             //  @@(primitive (- x y))@@
  prim2((y, x) => x+y),                             //  @@(primitive (+ x y))@@
  prim2((y, x) => bool2scm(x<y)),                //  @@(primitive (< x y) (use bool2scm))@@
  prim2((y, x) => bool2scm(x===y)),              //  @@(primitive (eqv? x y) (use bool2scm))@@
  prim1((x) => x[2]),                               //  @@(primitive (field2 rib))@@
  prim1((x) => x[1]),                               //  @@(primitive (field1 rib))@@
  prim1((x) => x[0]),                               //  @@(primitive (field0 rib))@@
  prim1((x) => bool2scm(is_rib(x))),             //  @@(primitive (rib? rib) (use bool2scm))@@
  () => push([pop()[0],stack,1]),                   //  @@(primitive (close rib))@@
  () => push([pop(),pop()][0]),                     //  @@(primitive (arg2 x y))@@
  () => (pop(), true),                              //  @@(primitive (arg1 x y))@@
  prim1((x) => x),                                  //  @@(primitive (id x))@@
];

call = (proc) => {
    if (debug) { console.log((pc[2]===0 ? "--- jump " : "--- call ") + show_opnd(proc)); show_stack(); } //debug
    o = proc
    let nargs=pop();
    // )@@
    let c = o[0];

    if (is_rib(c)) {
        let c2 = [0,o,0];
        let s2 = c2;


        let nparams = c[0] >> 1; 
        if (c[0] & 1 ? nparams > nargs : nparams != nargs){
            console.log("*** Unexpected number of arguments nargs:", nargs, " nparams:", nparams, "variadics:", c[0]&1);
            halt();
        }
        // )@@

        nargs-=nparams;
        if (c[0]&1) {
            let rest=NIL;
            while(nargs--) 
                rest=[pop(), rest, 0];
            s2=[rest,s2,0]
        }
        // )@@
        while (nparams--) s2 = [pop(),s2,0];

        if (pc[2]===0) {
            // jump
            let k = get_cont();
            c2[0] = k[0];
            c2[2] = k[2];
        } else {
            // call
            c2[0] = stack;
            c2[2] = pc[2];
        }
        stack = s2;
    } else {
        next_prim=primitives[c]()
        if (!next_prim) return;
        if (is_rib(next_prim)) {
            console.log('Next prim: ', next_prim);
            console.log('Nargs: ', stack[0]);
            let result = call(next_prim);
            console.dir(stack, {depth: 6});
            return result;
        }
        if (pc[2]===0) {
            // jump
            c = get_cont();
            stack[1] = c[0];
        } else {
            // call
            c = pc;
        }
    }
    return c;
}

run = () => {
  while (1) {
    let o = pc[1];
    switch (pc[0]) {
    case 5: // halt
        return;
    case 0: // jump/call
        pc = call(get_opnd(o)[0]);
        break;
    case 1: // set
        if (debug) { console.log("--- set " + show_opnd(o)); show_stack(); } //debug
        get_opnd(o)[0] = pop();
        break;
    case 2: // get
        if (debug) { console.log("--- get " + show_opnd(o)); show_stack(); } //debug
        push(get_opnd(o)[0]);
        break;
    case 3: // const
        if (debug) { console.log("--- const " + (is_rib(o) ? "" : ("int " + o))); show_stack(); } //debug
        push(o);
        break;
    case 4: // if
        if (debug) { console.log("--- if"); show_stack(); } //debug
        if (pop() !== FALSE) { pc = pc[1]; continue; }
        break;
    }
      pc = pc[2];
  }
};

if (isNode) run();
